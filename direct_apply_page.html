<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Direct Apply | SV Realty Solution</title>
<style>
body {margin:0; font-family:Arial,sans-serif; background:#f8f9fa; color:#333;}
header {background:#065c4c; color:#fff; padding:15px; text-align:center;}
.container {max-width:1000px; margin:30px auto; background:#fff; padding:30px; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.1);}
h1 {text-align:center; margin-bottom:20px; color:#065c4c;}
form label {display:block; margin-top:10px; font-weight:bold;}
form input, form select, form textarea {width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:5px; box-sizing:border-box;}
.row {display:flex; gap:40px; flex-wrap:wrap; margin-bottom:20px;}
.row > div {flex:1; min-width:250px;}
button {background-color:#ffb400; border:none; padding:12px 25px; color:#000; font-weight:bold; border-radius:5px; cursor:pointer; margin-top:20px;}
button:hover {background-color:#e09e00;}
button:disabled {background-color:#ccc; cursor:not-allowed;}
fieldset {border:1px solid #ddd; padding:20px; border-radius:8px; margin-top:30px; margin-bottom:30px;}
legend {font-weight:bold; color:#065c4c;}
.error {color:red; font-size:0.9em; margin-top:5px;}
@media (max-width: 600px) {
  .row {flex-direction: column; gap:15px;}
  .container {padding:20px; margin:15px;}
  button {width:100%; padding:12px;}
}
</style>
</head>
<body>
<header>
<h2>SV Realty Solution - Direct Apply</h2>
</header>

<div class="container">
<h1>Welcome to the Direct Apply Form</h1>
<p>Start your instant booking application process here.</p>

<form id="directApplyForm" name="direct-apply" method="POST" data-netlify="true" netlify-honeypot="bot-field">
  <input type="hidden" name="form-name" value="direct-apply">
  <input type="hidden" name="bot-field">

  <!-- Project Details -->
  <fieldset>
    <legend>Project Details</legend>
    <div class="row">
      <div>
        <label for="project">Project *</label>
        <select id="project" name="project" required>
          <option value="">Select</option>
          <option>Residential Plot</option>
          <option>Commercial Plot</option>
          <option>Farmhouse</option>
          <option>Villa</option>
        </select>
      </div>
      <div>
        <label for="unitType">Unit Type *</label>
        <select id="unitType" name="unitType" required>
          <option value="">Select</option>
          <option>Plot</option>
          <option>Shop</option>
          <option>Farmhouse</option>
          <option>Villa</option>
        </select>
      </div>
      <div>
        <label for="paymentPlan">Payment Plan *</label>
        <select id="paymentPlan" name="paymentPlan" required>
          <option value="">Select</option>
          <option>PLP</option>
          <option>DP</option>
        </select>
      </div>
    </div>
  </fieldset>

  <!-- Applicant Details -->
  <fieldset>
    <legend>Applicant Details</legend>
    <div class="row">
      <div>
        <label for="fullName">Full Name *</label>
        <input type="text" id="fullName" name="fullName" required>
      </div>
      <div>
        <label for="fatherName">S/o, D/o, W/o *</label>
        <input type="text" id="fatherName" name="fatherName" required>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="applicantEmail">Email *</label>
        <input type="email" id="applicantEmail" name="applicantEmail" required>
        <div id="applicantEmailError" class="error"></div>
      </div>
      <div>
        <label for="mobile">Mobile No *</label>
        <input type="tel" id="mobile" name="mobile" maxlength="10" required>
        <div id="mobileError" class="error"></div>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="aadhaar">AADHAAR Number *</label>
        <input type="text" id="aadhaar" name="aadhaar" maxlength="12" required>
        <div id="aadhaarError" class="error"></div>
      </div>
      <div>
        <label for="pan">PAN Number *</label>
        <input type="text" id="pan" name="pan" maxlength="10" required>
        <div id="panError" class="error"></div>
      </div>
    </div>

    <label for="address">Address *</label>
    <textarea id="address" name="address" rows="3" required></textarea>
  </fieldset>

  <!-- Co-Applicant Details (Optional) -->
  <fieldset>
    <legend>Co-Applicant Details</legend>
    <div class="row">
      <div>
        <label for="coName">Full Name</label>
        <input type="text" id="coName" name="coName">
      </div>
      <div>
        <label for="coEmail">Email</label>
        <input type="email" id="coEmail" name="coEmail">
        <div id="coEmailError" class="error"></div>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="coAadhaar">AADHAAR Number</label>
        <input type="text" id="coAadhaar" name="coAadhaar" maxlength="12">
        <div id="coAadhaarError" class="error"></div>
      </div>
      <div>
        <label for="coPan">PAN Number</label>
        <input type="text" id="coPan" name="coPan" maxlength="10">
        <div id="coPanError" class="error"></div>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="coMobile">Mobile No</label>
        <input type="tel" id="coMobile" name="coMobile" maxlength="10">
        <div id="coMobileError" class="error"></div>
      </div>
      <div>
        <label for="coAltMobile">Alternate Mobile No</label>
        <input type="tel" id="coAltMobile" name="coAltMobile" maxlength="10">
        <div id="coAltMobileError" class="error"></div>
      </div>
    </div>

    <label for="coAddress">Address</label>
    <textarea id="coAddress" name="coAddress" rows="3"></textarea>
  </fieldset>

  <!-- Preferences -->
  <fieldset>
    <legend>Preferences</legend>
    <div class="row">
      <div>
        <label for="unitPref">Unit Preference</label>
        <select id="unitPref" name="unitPref">
          <option value="">Select Unit Preference</option>
          <option>Corner Facing</option>
          <option>Park Facing</option>
          <option>Main Road Facing</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="amount">Amount Paid</label>
        <input type="number" id="amount" name="amount">
      </div>
      <div>
        <label for="receipt">Transaction ID</label>
        <input type="text" id="receipt" name="receipt">
      </div>
    </div>
  </fieldset>

  <!-- QR Code -->
  <fieldset>
    <legend>Payment QR</legend>
    <p>Scan this QR code to make your payment:</p>
    <img src="assets/qrcode.png" alt="Payment QR Code" width="200">
  </fieldset>

  <button type="submit" id="submitBtn" disabled>Submit Direct Application</button>
</form>
</div>

<script>
const form = document.getElementById("directApplyForm");
const submitBtn = document.getElementById("submitBtn");

const validators = {
  email: v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v),
  mobile: v => /^[6-9]\d{9}$/.test(v),
  pan: v => /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/i.test(v),
  aadhaar: v => /^\d{12}$/.test(v)
};

function validateField(id,type,optional=false){
  const value = document.getElementById(id).value.trim();
  const errorDiv = document.getElementById(id+"Error");
  if(!value && optional){ errorDiv.textContent=""; return true; }
  if(!validators[type](value)){
    errorDiv.textContent = type.toUpperCase()+" is invalid";
    return false;
  }
  errorDiv.textContent = "";
  return true;
}

function checkFormValidity(){
  const requiredFields = ["project","unitType","paymentPlan","fullName","fatherName","applicantEmail","mobile","aadhaar","pan","address"];
  const allFilled = requiredFields.every(id=>document.getElementById(id).value.trim()!=="");

  const emailValid = validateField("applicantEmail","email");
  const mobileValid = validateField("mobile","mobile");
  const panValid = validateField("pan","pan");
  const aadhaarValid = validateField("aadhaar","aadhaar");

  const coEmailValid = document.getElementById("coEmail").value.trim()==="" || validateField("coEmail","email",true);
  const coMobileValid = document.getElementById("coMobile").value.trim()==="" || validateField("coMobile","mobile",true);
  const coAltValid = document.getElementById("coAltMobile").value.trim()==="" || validateField("coAltMobile","mobile",true);
  const coAadhaarValid = document.getElementById("coAadhaar").value.trim()==="" || validateField("coAadhaar","aadhaar",true);
  const coPanValid = document.getElementById("coPan").value.trim()==="" || validateField("coPan","pan",true);

  submitBtn.disabled = !(allFilled && emailValid && mobileValid && panValid && aadhaarValid && coEmailValid && coMobileValid && coAltValid && coAadhaarValid && coPanValid);
}

// Add input listeners for validation
["applicantEmail","mobile","pan","aadhaar","coEmail","coMobile","coAltMobile","coPan","coAadhaar"].forEach(id=>{
  const el = document.getElementById(id);
  const type = id.includes("email")?"email":id.includes("mobile")?"mobile":id.includes("aadhaar")?"aadhaar":"pan";
  el.addEventListener("input", ()=>{
    if(type==="mobile"||type==="aadhaar"){
      const max = type==="mobile"?10:12;
      if(el.value.length>max) el.value = el.value.slice(0,max);
    }
    validateField(id,type,id.startsWith("co"));
    checkFormValidity();
  });
});

// Handle Netlify submission + redirect
form.addEventListener("submit", e=>{
  e.preventDefault();
  checkFormValidity();
  if(submitBtn.disabled) return;

  const formData = new FormData(form);
  fetch("/", {method:"POST", body:formData})
    .then(()=>{ window.location.href="thank-you.html"; })
    .catch(err=>alert("Form submission failed: "+err));
});
</script>
</body>
</html>
